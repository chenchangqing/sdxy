# 1.面试问题集锦

## 1.weak和assign的区别

### 一、什么情况使用 weak 关键字？

1. 在 ARC 中,在有可能出现循环引用的时候，往往要通过让其中一端使用 weak 来解决,比如： delegate 代理属性。
2. 自身已经对它进行一次强引用,没有必要再强引用一次,此时也会使用 weak ,自定义 IBOutlet 控件属性一般也使用 weak ；当然，也可以使用 strong 。

### 二、区别

#### 2.1.修饰变量类型的区别

1. weak 只可以修饰对象。如果修饰基本数据类型，编译器会报错-“Property with ‘weak’ attribute must be of object type”。
2. assign 可修饰对象，和基本数据类型。当需要修饰对象类型时，MRC时代使用 unsafe_unretained 。当然， unsafe_unretained 也可能产生野指针，所以它名字是 unsafe_ 。

#### 2.2.是否产生野指针的区别

1. weak 不会产生野指针问题。因为 weak 修饰的对象释放后（引用计数器值为0），指针会自动被置nil，之后再向该对象发消息也不会崩溃。 weak是安全的。
2.  assign 如果修饰对象，会产生野指针问题；如果修饰基本数据类型则是安全的。修饰的对象释放后，指针不会自动被置空，此时向对象发消息会崩溃。

### 三、相同

都可以修饰对象类型，但是 assign 修饰对象会存在问题。

### 四、总结

assign 适用于基本数据类型如 int,float,struct 等值类型，不适用于引用类型。因为值类型会被放入栈中，遵循先进后出原则，由系统负责管理栈内存。而引用类型会被放入堆中，需要我们自己手动管理内存或通过 ARC 管理。weak 适用于 delegate 和 block 等引用类型，不会导致野指针问题，也不会循环引用，非常安全。

### 五、参考文章

* [iOS开发中 weak 和 assign 的区别](https://www.jianshu.com/p/e9a46253f587)

## 2.为什么要用 Copy 修饰 Block 

### 一、栈区和堆区概念

1. 内存的栈区：由编译器自动分配释放，存放函数的参数值，局部变量的值等。 其操作方式类似于数据结构中的栈。
2. 内存的堆区：一般由程序员分配释放，若程序员不释放，程序结束时可能由OS回收。注意它与数据结构中的堆是两回事， 分配方式倒是类似于链表。

### 二、Block 的三种类型

iOS 内存分布，一般分为：栈区、堆区、全局区、常量区、代码区。其实 Block 也是一个 Objective-C 对象，常见的有以下三种 Block ：

1. NSGlobalBlock：全局的静态 Block 没有访问外部变量。
2. NSStackBlock：保存在栈中的 Block ，没有用copy去修饰并且访问了外部变量，会在函数调用结束被销毁（需要在MRC）。
3. NSMallocBlock：保存在堆中的 Block , 此类型 Block 是用 Copy 修饰出来的 Block ，它会随着对象的销毁而销毁，只要对象不销毁，我们就可以调用的到在堆中的 Block 。

### 三、回答

Block 引用了普通外部变量，都是创建在栈区的；对于分配在栈区的对象，我们很容易会在释放之后继续调用，导致程序奔溃，所以我们使用的时候需要将栈区的对象移到堆区，来延长该对象的生命周期。对于这个问题，得区分 MRC 环境和 ARC 环境：

* 对于 MRC 环境，使用 Copy 修饰 Block，会将栈区的 Block 拷贝到堆区。
* 对于 ARC 环境，使用 Strong、Copy 修饰 Block，都会将栈区的 Block 拷贝到堆区。
* 所以，Block 不是一定要用 Copy 来修饰的，在 ARC 环境下面 Strong 和 Copy 修饰效果是一样的。

### 四、参考文章

* [iOS block 为什么用copy修饰](https://www。jianshu。com/p/de1beba9958e)
* [为什么要用copy修饰Block](https://www。jianshu。com/p/3b9b90d5be0b)
* [·iOS 面试题·Block 的原理，Block 的属性修饰词为什么用 copy，使用 Block 时有哪些要注意的？](https://www。jianshu。com/p/4db3b4f1d522)